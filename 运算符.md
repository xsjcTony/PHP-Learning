# 运算符 (Operator)

[PHP: Operators - Manual](https://www.php.net/manual/en/language.operators.php)

- 通过一个或多个 `表达式`, 生成一个 `值`



| 种类       | 运算符                             | 注意点                                                    |
| ---------- | ---------------------------------- | --------------------------------------------------------- |
| 算数运算符 | `+` , `-` , `*` , `/` , `%` , `**` | 将 `+` / `-` 置于变量之前会将其转换为 `integer` / `float` |
|            |                                    |                                                           |
|            |                                    |                                                           |

---

## 分类



### 算数 (Arithmetic)

- `+` , `-` , `*` , `/` , `%` , `**`
- 将 `+` / `-` 置于变量之前会将其转换为 `integer` / `float`
- `/` 会返回 `float`, 除非两个数都是 `integer` 并且可以被整除
  - 如果除数为 `0`, 那么程序会崩溃
  - 如果想让除数为 `0` 的情况返回 `INF` / `-INF`, 使用 `fdiv()` (永远返回 `float`)
- `%` 会在计算之前将两个值都转换为 `integer`, 并返回 `integer`
  - 若想要使用 `float` 进行计算, 则使用 `fmod()`
  - 正负性取决于 `被除数`



### 赋值 (Assignment)

- `=` , `+=` , `-=` , `*=` , `/=` , `%=` , `**=` / `.=`
- `=` 可以链式赋值

```php
$x = $y = 10;
```

- 其余的就是 `算数运算符` / `字符串运算符` 和 `=` 的组合
- 默认情况下赋值的是 `数值` 而不是 `引用`
  - 使用 `&` 来赋值 `引用`



### 字符串 (String)

- `.` , `.=`
- 将两个 `string` 连接起来



### 比较 (Comparison)

- `==` , `===` , `!=` , `<>` , `!==` , `<` , `>` , `<=` , `>=` , `<=>`
- `==` / `!=` 会自动转换类型之后再比较, 而 `===` / `!==` 不会 (类型也会被比较)
  - `<>` 和 `!=` 完全相同
- `a <=> b`
  - 如果 `a` 小于 `b`, 则返回 `-1`
  - 如果 `a` 等于 `b`, 则返回 `0`
  - 如果 `a` 大于 `b`, 则返回 `1`
- 如果 `string` 不是 `numeric` 的, 那么另一边会被转换为 `string` 之后再比较, 反之会将 `string` 转换为 `integer` / `float`
  - 以上只应用于 `PHP8+` , 对于 `PHP7-` , 无论如何都会将 `string` 转换为 `integer` / `float` 之后再比较



### Null coalescing

- `??`
- 对于 `a ?? b`, 只有 `a` 为 `null` 的情况下结果才为 `b`



### 三元 (Ternary / Conditional)

- `? :`
- 对于 `a ? b : c`, 若 `a` 为 `truthy`, 则结果为 `b`, 否则结果为 `c`



### Error Control

- `@`
- 可以 suppress 表达式中的错误, `@expression`
- ❌尽量不要使用



### 自增/自减 (Increment / Decrement)

- `++` , `--`
- 放在变量 `之后` 会在值返回之后再 `自增 / 自减`
- 放在变量 `之前` 会在 `自增 / 自减` 之后再返回
- 特殊情况
  - `++null` 会变成 `1`, `--` 无效
  - `++` 应用在 `string` 上会增加 `ascii` 码的值, 比如 `abc` 会变成 `abd`



### 逻辑 (Logical)

- `&&` , `||` , `!` , `and` , `xor` , `or`
- 会在比较时自动将类型转换为 `boolean`
- `&&` , `||` 和 `and` , `or` 的 `优先级` 不同
  - `and` , `or` , `xor` 的优先级比 `=` 还低, 要注意
- 会 `短路`



### 位 (Bitwise)

- `&` , `|` , `^` , `~` , `<<` , `>>`
- 除非两个值都是 `string`, 否则会统一转换为 `integer` 再进行运算
  - 对于两个 `string`, 会将他们的 `ascii` 码进行运算
- `&` and

```php
$x = 6; // 110
$y = 3; // 011
echo $x & $y; // 2

/**
 * 110
 * &
 * 011
 * ---
 * 010 = 2
 */
```

- `|` or

```php
$x = 6; // 110
$y = 3; // 011
echo $x | $y; // 7

/**
 * 110
 * |
 * 011
 * ---
 * 111 = 7
 */
```

- `^` xor

```php
$x = 6; // 110
$y = 3; // 011
echo $x ^ $y; // 7

/**
 * 110
 * ^
 * 011
 * ---
 * 101 = 5
 */
```

- `~` not

```php
$x = 6; // 110
$y = 3; // 011
echo ~$x & $y; // 1

/**
 * ~
 * 110
 * ---
 * 001
 * &
 * 011
 * ---
 * 001 = 1
 */
```

- `<<` shift left
  - 每左移一次相当于 `乘以2` (二进制下往后加 `0`)

```php
$x = 6; // 110
$y = 3;
echo $x << $y; // 48

/**
 * 110
 * << 3
 * 110000 = 48
 */
```

- `>>` shift right
  - 每右移一次相当于 `除以2` (二进制下去掉最后一位)

```php
$x = 6; // 110
$y = 1;
echo $x >> $y; // 3

/**
 * 110
 * >> 1
 * 11 = 3
 */
```



### 数组 (Array)

- `+` , `==` , `===` , `!=` , `<>` , `!==`
- 这些运算符用在 `数组` 上时有其特殊含义
- `+` union, 对于 `a + b`
  - 会将 `b` 中所有和 `a` 不重合的 `key` 拼接到 `a` 中

- `==` , `!=` , `<>`
  - 会比较两个数组的 `key value pair` 是否相等
  - 不在意 `顺序` 和 `数据类型`
  - `<>` 和 `!=` 完全一样
- `===` , `!==`
  - 相比于 `==` 和 `!=` , 他们在意 `顺序` 和 `数据类型`



### instanceof (Type)

- `a instanceof b`

- 检查一个变量是否是某个特定 `类` 的 `实例`



### nullsafe

- `a?->b()?->c`
- 和 `JavaScript` 的 `optional chain` `a?.b()?.c` 一个意思
- ❗`PHP8+` 才有

---

## 优先级 & 结合性 (Precedence & associativity)





